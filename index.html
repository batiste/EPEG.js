<html>
<head>
<style>
body, html {
  font-weight:16px;
  font-family: Helvetica neue, sans-serif;
}
textarea {
  width:100%;
  height:600px;
  font-size:14px;
}
div.col {
  float:left;
  width:30%;
  margin-right:3%;
}
h1, h2, h3 {
  margin: 0.4em 0;
}
#error {
  padding:0 1em;
  background: #fee;
  position:absolute;
  bottom:1;
  left:1;
  right:1;
  margin:0;
}
button {
  font-size:1.2em
}
</style>
</head>
<body>
<h1>
CokeScript
</h1>

<p>CokeScript is a Python-like language that compile to JavaScript. CokeScript doesn't try to be too smart and is mainly syntactic sugar around common JavasScript annoyances. Features:</p>

<ol>
<li>Multiline strings</li>
<li>Significant whitespace</li>
<li>Short function declaration and lambda expression</li>
<li>Function parameters default values</li>
<li>Simple <strong>for</strong> loop syntax that works on Array or Object</li>
<li>Sensible scoping rules unlike <a href="https://donatstudios.com/CoffeeScript-Madness">CoffeeScript</a></li>
<li>Classes and inheritance</li>
</ol>

<p>More info on the github page <a href="https://github.com/batiste/EPEG.js">https://github.com/batiste/EPEG.js</a></p>

<div style="clear:both">
<div class="col" style="position:relative">
  <h2>Input language</h2>
<textarea id="in">
// Objects
class Animal
  
  def constructor(name="unknown")
    this.name = name
  
  def eat(what="grass")
    this.diet = what

class Tiger(Animal)
  
  def constructor()
   this.name = "Tigger"

tiger = Tiger()
tiger.diet = "meat"

g = "multiline
string"

def fib(n)
  if n < 2
    return n
  return fib(n-2) + fib(n-1)

array = [1, 2, 2 + 1]
object = {
  sqrt: def(i) i*i,
  toto: [1, 2]
}

// function parameters can have default values
def test(a, b=1+1)
  a = 1
  // avoiding the error of CoffeeScript: no implicit global
  g = 1
  // explicitly assign to a outer scope variable with :=
  array := [1]
  return def(f) a + 10

for key, value in array
  if value == 1
    break
  else
    console.log(key, value)

array.map(def(i) fib(object.sqrt(i)))
</textarea>



<pre id="error" style=""></pre>



</div>
<div class="col">
<h2>AST</h2>
<textarea id="out"></textarea>
</div>

<div class="col">
<h2>Output language</h2>
<textarea id="code"></textarea>
<button id="evalButton">Eval</button>
<pre id="evalResult"></pre>
</div>
</div>

<h2>Grammar definition</h2>

<pre id="grammarOut"></pre>

<h2>Tokens definition</h2>

<pre id="tokenOut"></pre>

<script src='parser.js'></script>
<script src='cokescript.js'></script>
<script>

window.onload = function() {

function dGet(id){ return document.getElementById(id); }
var din = dGet('in');
var dout = dGet('out');
var code = dGet('code');
var gOut = dGet('grammarOut');
gOut.textContent = JSON.stringify(CokeScript.grammarDef, false, 2);
var tOut = dGet('tokenOut');
tOut.textContent = JSON.stringify(CokeScript.tokenDef, false, 2);

dGet('evalButton').onclick = function() {
  var result = eval(code.value);
  dGet('evalResult').textContent = result;
};

din.onkeyup = function() {
  outit();
};

function outit() {
  try {
    var result = CokeScript.generateModule(din.value);
    code.value = result.code;
    dout.value = JSON.stringify(result.ast, false, 2);
    document.getElementById("error").textContent = "";
  } catch(e) {
    document.getElementById("error").textContent = String(e);
    throw e;
  }
}

outit();

};

</script>