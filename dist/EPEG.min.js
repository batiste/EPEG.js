!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.EPEG=e()}}(function(){return function e(n,t,r){function o(a,p){if(!t[a]){if(!n[a]){var u="function"==typeof require&&require;if(!p&&u)return u(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var f=t[a]={exports:{}};n[a][0].call(f.exports,function(e){var t=n[a][1][e];return o(t?t:e)},f,f.exports,e,n,t,r)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,n){"use strict";function t(e,n){for(var t,r,o,i=n.tokenKeys,a=n.tokenMap,p=[],u=e.length,s=e,f=null,l=0;u>l;){for(t=null,r=0;r<i.length;r++){o=i[r];var h,c=a[o];if(c.func){if(h=c.func(e),void 0!==h){t=h;break}}else{if(!c.reg)throw"Invalid token "+o+" without a reg or fund property";if(h=e.match(c.reg),null!==h){t=h[0];break}}}if(null===t){f&&(f.pointer+=f.value.length);var v=d(s,p,p.length-1,"Tokenizer error","No matching token found");throw f&&(v+="\nBefore token of type "+f.type+": "+f.value),v}f={type:o,value:t,pointer:l},p.push(f),l+=t.length,e=e.substr(t.length)}return p.push({type:"EOF",value:""}),p}function r(e,n){var t={type:e.type,value:e.value,repeat:n.repeat};return n.name&&(t.name=n.name),t}function o(e){var n={},t=0;return e.map(function(e){e.name&&("*"==e.repeat?(n[e.name]||(n[e.name]=[]),n[e.name].push(e)):n[e.name]=e),n["$"+t]=e,t++}),n}function i(e,n,t,r,i){for(var a,p,u=!1,f=e[n.key].hooks[n.index];;){if(a=r,p=s(e,n,t,a),p===!1||p.sp<=i.sp)return u;f&&!p.hooked&&(p.children=f(o(p.children)),p.hooked=!0),p.hooked=!0,i.children=p.children,i.sp=p.sp,i.start=p.start,i.hooked=p.hooked,u=p}return u}function a(e,n,t,r){for(var o=n.key+";"+r+";"+n.index,i=g.length-1;i>=0;){if(g[i][0]==o)return!1;i-=1}var a=m[n.key+";"+r];if(void 0!==a)return a;g.push([o,n]);var p=s(e,n,t,r);return g.pop(),p}function p(e,n){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&n.children.length&&n.children[n.children.length-1].type==e.type?!0:!1}function u(e){return"*"===e.repeat||"+"===e.repeat}function s(e,n,t,s){for(var f,l,h=s,c=0,d={type:n.key,children:[],start:s,name:n.name},v=n.tokens[c],y=t[h];v&&y;){if(e[v.type]){var k=e[v.type].rules,g=e[v.type].hooks;l=!1;var w=m[v.type+";"+h];if(w&&(l=w),!l)for(f=0;f<k.length;f++){var T=k[f],O=g&&g[f];if(l=a(e,T,t,h)){if(O&&!l.hooked&&(l.children=O(o(l.children))),l.hooked=!0,m[T.key+";"+h]=l,v.repeat===!1){var E=i(e,n,t,h,l);if(E!==!1)return E}break}}if(l)h=l.sp,d.children.push({type:v.type,children:l.children,sp:l.sp,name:v.name,repeat:v.repeat}),u(v)||c++;else{if(!p(v,d))return!1;c++}}else if(y.type===v.type)v.nonCapturing||(d.children.push(r(y,v)),h++),u(v)||c++;else{if(!p(v,d))return!1;c++}if(x===h&&b.candidates.push([n,n.tokens[c]]),h>x&&(b={sp:h,candidates:[[n,n.tokens[c]]]},x=h),v=n.tokens[c],y=t[h],void 0===v)return d.sp=h,d.rp=c,d;if(void 0===y)return p(v,d)?(d.sp=h,d.rp=c,d):!1}return!1}function f(e,n){return e.split(n).map(function(e){return e.trim()})}function l(e){var n="!"===e.charAt(0);n&&(e=e.substr(1));var t=e.charAt(e.length-1);"*"===t||"?"===t||"+"===t?e=e.substr(0,e.length-1):t=!1;var r,o=e.split(":");if(r=2===o.length?{type:o[1],name:o[0]}:{type:e},r.repeat=t,("*"===t||"+"===t)&&n)throw"Impossible to have non capturing token that repeats";return n&&(r.nonCapturing=n),r}function h(e,n){var t,r,o,i=Object.keys(e),a={};a.tokenDef=n,a.tokenKeys=[],a.tokenMap={},n.map(function(e){a.tokenMap[e.key]=e,a.tokenKeys.push(e.key)});var p=i.concat(a.tokenKeys);for(t=0;t<i.length;t++){var u=e[i[t]],s=i[t],h=u.rules,c=[];for(r=0;r<h.length;r++){var d=f(h[r]," ");if(o=0,d=d.map(function(e){var n=l(e);if(-1===p.indexOf(n.type)&&"EOF"!==n.type)throw"Invalid token type used in the grammar: "+n.type;if("*"===n.repeat&&(o+=1),n.nonCapturing&&d[d.length-1]!=e)throw"Non capturing token has to be the last one in the rule: "+n.type;return n}),o===d.length)throw"Rule "+h[r]+" only has * tokens.";c.push({key:s,index:r,tokens:d})}a[s]={rules:c,hooks:u.hooks||[],verbose:u.verbose}}return a.parse=function(e){return k(e,a)},a}function c(e){for(var n="",t=0;e>t;t++)n+=" ";return n}function d(e,n,t,r,o){var i,a=n[t],p=a.pointer||0,u=e.split("\n"),s=0,f=0;for(i=0;i<u.length&&(s+=u[i].length+1,!(s>=p));i++)f+=u[i].length+1;var l=Math.max(0,i),h=r+" at line "+(l+1)+" char "+(p-f)+": ",d="\n"+c(p-f+(l+": ").length);return void 0!==u[l-1]&&(h=h+"\n"+l+": "+u[l-1]),h=h+"\n"+(l+1)+": "+u[l]+d,h=h+"^-- "+o,void 0!==u[l+1]&&(h=h+"\n"+(l+2)+": "+u[l+1]),h}function v(e,n){var t=e.tokenMap[n];return t&&t.verbose?t.verbose:e[n]&&e[n].verbose?e[n].verbose:n}function y(e,n,t,r){if(!t||!t.candidates[0])return"Complete failure to parse";var o=t.candidates[0][0],i=[];t.candidates.map(function(e){if(e[1]){var n=v(r,e[1].type);-1===i.indexOf(n)&&i.push(n)}});var a=i.join(" or "),p=d(e,n,t.sp,"Parser error","Rule "+v(r,o.key));p=p+"\nExpect "+a;var u=n[t.sp]||{type:"EOF"};return p=p+"\nBut got "+v(r,u.type)+" instead"}function k(e,n){var r,o,i,p={type:"START",sp:0,complete:!1};for(i=t(e,n),b={sp:0,candidates:[]},x=0,r=0;r<n.START.rules.length;r++)g=[],m={},o=a(n,n.START.rules[r],i,0),o&&o.sp>p.sp&&(p={type:"START",children:o.children,sp:o.sp,complete:o.sp===i.length,inputLength:i.length});return p.bestParse=b,b&&!p.complete&&(p.hint=y(e,i,b,n)),p}var g=[],m={},b=null,x=0;n.exports={parse:k,stack:g,compileGrammar:h,tokenize:t,memoization:m}},{}]},{},[1])(1)});