!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.EPEG=e()}}(function(){return function e(r,n,t){function o(a,u){if(!n[a]){if(!r[a]){var p="function"==typeof require&&require;if(!u&&p)return p(a,!0);if(i)return i(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var s=n[a]={exports:{}};r[a][0].call(s.exports,function(e){var n=r[a][1][e];return o(n?n:e)},s,s.exports,e,r,n,t)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,r){"use strict";function n(e,r){for(var n,t,o,i=r.tokenKeys,a=r.tokenMap,u=[],p=e.length,f=e,s=null,l=0;p>l;){for(n=null,t=0;t<i.length;t++){o=i[t];var h,c=a[o];if(c.func){if(h=c.func(e,u),void 0!==h){n=h;break}}else{if(!c.reg)throw new Error("Tokenizer error: Invalid token "+o+" without a reg or func property");if(h=e.match(c.reg),null!==h){n=h[0];break}}}if(null===n){if(0===u.length)throw new Error("Tokenizer error: total match failure");s&&(s.pointer+=s.value.length);var v=d(f,u[u.length-1],"Tokenizer error","No matching token found");throw s&&(v+="\nBefore token of type "+s.type+": "+s.value),new Error(v)}s={type:o,value:n,pointer:l},u.push(s),l+=n.length,e=e.substr(n.length)}return u.push({type:"EOF",value:""}),u}function t(e,r){var n={type:e.type,value:e.value,repeat:r.repeat};return r.name&&(n.name=r.name),n}function o(e){var r={},n=0;return e.map(function(e){e.name&&("*"==e.repeat||"+"==e.repeat?(r[e.name]||(r[e.name]=[]),r[e.name].push(e)):r[e.name]=e),r["$"+n]=e,n++}),r}function i(e,r,n,t,o){for(var i,a,u=!1,p=e[r.key].hooks[r.index];;){if(i=t,a=f(e,r,n,i),a===!1||a.sp<=o.sp)return u;a.hook=p,o.children=a.children,o.sp=a.sp,o.start=a.start,o.hooked=a.hooked,o.hook=a.hook,u=a}return u}function a(e,r,n,t){for(var o=r.key+";"+t+";"+r.index,i=m.length-1;i>=0;){if(m[i][0]==o)return!1;i-=1}var a=w[r.key+";"+t];if(void 0!==a)return a;m.push([o,r]);var u=f(e,r,n,t);return m.pop(),u}function u(e,r){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&r.children.length&&r.children[r.children.length-1].type==e.type?!0:!1}function p(e){return"*"===e.repeat||"+"===e.repeat}function f(e,r,n,o){for(var f,s,l=o,h=0,c={type:r.key,children:[],start:o,name:r.name},d=r.tokens[h],v=n[l];d&&v;){if(e[d.type]){var k=e[d.type].rules,y=e[d.type].hooks;s=!1;var g=w[d.type+";"+l];if(g&&(s=g),!s)for(f=0;f<k.length;f++){var m=k[f],x=y[f];if(s=a(e,m,n,l)){if(s.hook=x,w[m.key+";"+l]=s,d.repeat===!1){var T=i(e,r,n,l,s);if(T!==!1)return T}break}}if(s)l=s.sp,c.children.push({type:d.type,children:s.children,sp:s.sp,hook:s.hook,name:d.name,repeat:d.repeat}),p(d)||h++;else{if(!u(d,c))return!1;h++}}else if(v.type===d.type)d.nonCapturing||(c.children.push(t(v,d)),l++),p(d)||h++;else{if(!u(d,c))return!1;h++}if(E===l&&b.candidates.push([r,r.tokens[h]]),l>E&&(b={sp:l,candidates:[[r,r.tokens[h]]]},E=l),d=r.tokens[h],v=n[l],void 0===d)return c.sp=l,c.rp=h,c;if(void 0===v)return u(d,c)?(c.sp=l,c.rp=h,c):!1}return!1}function s(e,r){return e.split(r).map(function(e){return e.trim()})}function l(e){var r="!"===e.charAt(0);r&&(e=e.substr(1));var n=e.charAt(e.length-1);"*"===n||"?"===n||"+"===n?e=e.substr(0,e.length-1):n=!1;var t,o=e.split(":");if(t=2===o.length?{type:o[1],name:o[0]}:{type:e},t.repeat=n,("*"===n||"+"===n)&&r)throw new Error("Impossible to have non capturing token that repeats");return r&&(t.nonCapturing=r),t}function h(e,r){var n,t,o,i,a=Object.keys(e),u={};u.tokenDef=r,u.tokenKeys=[],u.tokenMap={},r.map(function(e){u.tokenMap[e.key]=e,u.tokenKeys.push(e.key)});var p=a.concat(u.tokenKeys);for(n=0;n<a.length;n++){var f=e[a[n]],h=a[n],c=f.rules,d=[],v=[];for(t=0;t<c.length;t++){var k=s(c[t]," ");for(i=0,o=0;o<k.length;o++){var y=k[o]=l(k[o]);if(-1===p.indexOf(y.type)&&"EOF"!==y.type)throw new Error("Invalid token type used in the grammar rule "+h+": "+y.type+", valid tokens are: "+p.join(", "));if("*"===y.repeat&&(i+=1),y.nonCapturing&&k[k.length-1]!=k[o])throw new Error("A non capturing token can only be the last one in the rule: "+y.type)}if(i===k.length)throw new Error("Rule "+c[t]+" only has optional greedy tokens.");if(v.push({key:h,index:t,tokens:k}),"function"==typeof f.hooks)d.push(f.hooks);else if(f.hooks){if(void 0===f.hooks[t])throw new Error("Incorrect number of hooks ar rule "+a[n]);d.push(f.hooks[t])}}u[h]={rules:v,hooks:d||[],verbose:f.verbose}}return u.parse=function(e){return g(e,u)},u}function c(e){for(var r="",n=0;e>n;n++)r+=" ";return r}function d(e,r,n,t){var o,i=r.pointer||0,a=e.split("\n"),u=0,p=0;for(o=0;o<a.length&&(u+=a[o].length+1,!(u>=i));o++)p+=a[o].length+1;var f=Math.max(0,o),s=n+" at line "+(f+1)+" char "+(i-p)+": ",l="\n"+c(i-p+(f+": ").length);return void 0!==a[f-1]&&(s=s+"\n"+f+": "+a[f-1]),s=s+"\n"+(f+1)+": "+a[f]+l,s=s+"^-- "+t,void 0!==a[f+1]&&(s=s+"\n"+(f+2)+": "+a[f+1]),s}function v(e,r){var n=e.tokenMap[r];return n&&n.verbose?n.verbose:e[r]&&e[r].verbose?e[r].verbose:r}function k(e,r,n,t){if(!n||!n.candidates[0])return"Complete failure to parse";var o=n.candidates[0][0],i=[];n.candidates.map(function(e){if(e[1]){var r=v(t,e[1].type);-1===i.indexOf(r)&&i.push(r)}});var a=i.join(" or "),u=d(e,r[n.sp],"Parser error","Rule "+v(t,o.key));u=u+"\nExpect "+a;var p=r[n.sp]||{type:"EOF"};return u=u+"\nBut got "+v(t,p.type)+" instead"}function y(e){if(e.children){e.hook&&(e.children=e.hook(o(e.children)));for(var r=0;r<e.children.length;r++)y(e.children[r])}}function g(e,r){var t,o,i,u={type:"START",sp:0,complete:!1};for(i=n(e,r),b={sp:0,candidates:[]},E=0,t=0;t<r.START.rules.length;t++)m=[],w={},o=a(r,r.START.rules[t],i,0),o&&o.sp>u.sp&&(u={type:"START",children:o.children,sp:o.sp,complete:o.sp===i.length,inputLength:i.length});return u.bestParse=b,y(u),b&&!u.complete&&(u.hint=k(e,i,b,r)),u}var m=[],w={},b=null,E=0;r.exports={parse:g,stack:m,compileGrammar:h,tokenize:n,memoization:w}},{}]},{},[1])(1)});