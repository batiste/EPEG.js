!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.EPEG=e()}}(function(){return function e(n,r,t){function o(a,u){if(!r[a]){if(!n[a]){var l="function"==typeof require&&require;if(!u&&l)return l(a,!0);if(i)return i(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var s=r[a]={exports:{}};n[a][0].call(s.exports,function(e){var r=n[a][1][e];return o(r?r:e)},s,s.exports,e,n,r,t)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,n){"use strict";function r(e,n){for(var r,i,a,u=n.tokenKeys,l=n.tokenMap,p=[],s=e.length,f=e,h=null,c=0,d=0,v=0;s>c;){for(r=null,i=0;i<u.length;i++){a=u[i];var y,m=l[a];if(m.func){if(y=m.func(e,p),void 0!==y){r=y;break}}else if(m.reg){if(y=e.match(m.reg),null!==y){r=y[0];break}}else{if(!m.str)throw new Error("Tokenizer error: Invalid token "+a+" without a reg, str or func property");if(y=e.indexOf(m.str),0===y){r=m.str;break}}}if(null===r){if(0===p.length)throw new Error("Tokenizer error: total match failure");h&&(h.pointer+=h.value.length);var g=k(f,p[p.length-1],"Tokenizer error","No matching token found");throw h&&(g+="\nBefore token of type "+h.type+": "+h.value),new Error(g)}h={type:a,value:r,pointer:c,line:d+1,column:v+1},p.push(h);var w=t(r);d+=w,w>0&&(v=0),v+=o(r),c+=r.length,e=e.substr(r.length)}return p.push({type:"EOF",value:""}),p}function t(e){var n=e.split(/\n/g);return n.length-1}function o(e){var n=e.split(/\n/g);return n[n.length-1].length}function i(e,n){var r={type:e.type,value:e.value,repeat:n.repeat,line:e.line,column:e.column};return n.name&&(r.name=n.name),r}function a(e){var n={},r=0;return e.map(function(e){e.name&&("*"==e.repeat||"+"==e.repeat?(n[e.name]||(n[e.name]=[]),n[e.name].push(e)):n[e.name]=e),n["$"+r]=e,r++}),n}function u(e,n,r,t,o){for(var i,a,u=!1,l=e[n.key].hooks[n.index];;){if(i=t,a=f(e,n,r,i),a===!1||a.sp<=o.sp)return u;a.hook=l,o.children=a.children,o.sp=a.sp,o.line=a.line,o.column=a.column,o.start=a.start,o.hooked=a.hooked,o.hook=a.hook,u=a}return u}function l(e,n,r,t){for(var o=n.key+";"+t+";"+n.index,i=b.length-1;i>=0;){if(b[i][0]==o)return!1;i-=1}var a=E[n.key+";"+t];if(void 0!==a)return a;b.push([o,n]);var u=f(e,n,r,t);return b.pop(),u}function p(e,n){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&n.children.length&&n.children[n.children.length-1].type==e.type?!0:!1}function s(e){return"*"===e.repeat||"+"===e.repeat}function f(e,n,r,t){for(var o,a,f=t,h=0,c=n.tokens[h],d=r[f],v={type:n.key,children:[],start:t,name:n.name,line:d.line,column:d.column};c&&d;){if(e[c.type]){var k=e[c.type].rules,y=e[c.type].hooks;a=!1;var m=E[c.type+";"+f];if(m&&(a=m),!a)for(o=0;o<k.length;o++){var g=k[o],w=y[o];if(a=l(e,g,r,f)){if(a.hook=w,E[g.key+";"+f]=a,c.repeat===!1){var b=u(e,n,r,f,a);if(b!==!1)return b}break}}if(a)f=a.sp,v.children.push({type:c.type,children:a.children,sp:a.sp,line:a.line,column:a.column,hook:a.hook,name:c.name,repeat:c.repeat}),s(c)||h++;else{if(!p(c,v))return!1;h++}}else if(d.type===c.type)c.nonCapturing||(v.children.push(i(d,c)),f++),s(c)||h++;else{if(!p(c,v))return!1;h++}if(T===f&&x.candidates.push([n,n.tokens[h]]),f>T&&(x={sp:f,candidates:[[n,n.tokens[h]]]},T=f),c=n.tokens[h],d=r[f],void 0===c)return v.sp=f,v.rp=h,v;if(void 0===d)return p(c,v)?(v.sp=f,v.rp=h,v):!1}return!1}function h(e,n){return e.split(n).map(function(e){return e.trim()})}function c(e){var n="!"===e.charAt(0);n&&(e=e.substr(1));var r=e.charAt(e.length-1);"*"===r||"?"===r||"+"===r?e=e.substr(0,e.length-1):r=!1;var t,o=e.split(":");if(t=2===o.length?{type:o[1],name:o[0]}:{type:e},t.repeat=r,("*"===r||"+"===r)&&n)throw new Error("Impossible to have non capturing token that repeats");return n&&(t.nonCapturing=n),t}function d(e,n){var r,t,o,i,a=Object.keys(e),u={};u.tokenDef=n,u.tokenKeys=[],u.tokenMap={},n.map(function(e){u.tokenMap[e.key]=e,u.tokenKeys.push(e.key)});var l=a.concat(u.tokenKeys);for(r=0;r<a.length;r++){var p=e[a[r]],s=a[r],f=p.rules,d=[],v=[];for(t=0;t<f.length;t++){var k=h(f[t]," ");for(i=0,o=0;o<k.length;o++){var y=k[o]=c(k[o]);if(-1===l.indexOf(y.type)&&"EOF"!==y.type)throw new Error("Invalid token type used in the grammar rule "+s+": "+y.type+", valid tokens are: "+l.join(", "));if("*"===y.repeat&&(i+=1),y.nonCapturing&&k[k.length-1]!=k[o])throw new Error("A non capturing token can only be the last one in the rule: "+y.type)}if(i===k.length)throw new Error("Rule "+f[t]+" only has optional greedy tokens.");if(v.push({key:s,index:t,tokens:k}),"function"==typeof p.hooks)d.push(p.hooks);else if(p.hooks){if(void 0===p.hooks[t])throw new Error("Incorrect number of hooks ar rule "+a[r]);d.push(p.hooks[t])}}u[s]={rules:v,hooks:d||[],verbose:p.verbose}}return u.parse=function(e){return w(e,u)},u}function v(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function k(e,n,r,t){var o,i=n.pointer||0,a=e.split("\n"),u=0,l=0;for(o=0;o<a.length&&(u+=a[o].length+1,!(u>=i));o++)l+=a[o].length+1;var p=Math.max(0,o),s=r+" at line "+(p+1)+" char "+(i-l)+": ",f="\n"+v(i-l+(p+": ").length);return void 0!==a[p-1]&&(s=s+"\n"+p+": "+a[p-1]),s=s+"\n"+(p+1)+": "+a[p]+f,s=s+"^-- "+t,void 0!==a[p+1]&&(s=s+"\n"+(p+2)+": "+a[p+1]),s}function y(e,n){var r=e.tokenMap[n];return r&&r.verbose?r.verbose:e[n]&&e[n].verbose?e[n].verbose:n}function m(e,n,r,t){if(!r||!r.candidates[0])return"Complete failure to parse";var o=r.candidates[0][0],i=[];r.candidates.map(function(e){if(e[1]){var n=y(t,e[1].type);-1===i.indexOf(n)&&i.push(n)}});var a=i.join(" or "),u=k(e,n[r.sp],"Parser error","Rule "+y(t,o.key));u=u+"\nExpect "+a;var l=n[r.sp]||{type:"EOF"};return u=u+"\nBut got "+y(t,l.type)+" instead"}function g(e){if(e.children){for(var n=0;n<e.children.length;n++)g(e.children[n]);e.hook&&(e.children=e.hook(a(e.children)))}}function w(e,n){var t,o,i,a={type:"START",sp:0,complete:!1};for(i=r(e,n),x={sp:0,candidates:[]},T=0,t=0;t<n.START.rules.length;t++)b=[],E={},o=l(n,n.START.rules[t],i,0),o&&o.sp>a.sp&&(a={type:"START",children:o.children,sp:o.sp,line:1,column:1,complete:o.sp===i.length,inputLength:i.length});return a.bestParse=x,g(a),x&&!a.complete&&(a.hint=m(e,i,x,n)),a}var b=[],E={},x=null,T=0;n.exports={parse:w,stack:b,compileGrammar:d,tokenize:r,memoization:E}},{}]},{},[1])(1)});