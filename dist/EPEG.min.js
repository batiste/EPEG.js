!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.EPEG=e()}}(function(){return function e(n,r,t){function o(a,p){if(!r[a]){if(!n[a]){var u="function"==typeof require&&require;if(!p&&u)return u(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var f=r[a]={exports:{}};n[a][0].call(f.exports,function(e){var r=n[a][1][e];return o(r?r:e)},f,f.exports,e,n,r,t)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,n){"use strict";function r(e,n){for(var r,t,o,i=n.tokenKeys,a=n.tokenMap,p=[],u=e.length,s=e,f=null,l=0;u>l;){for(r=null,t=0;t<i.length;t++){o=i[t];var h,c=a[o];if(c.func){if(h=c.func(e),void 0!==h){r=h;break}}else{if(!c.reg)throw new Error("Invalid token "+o+" without a reg or func property");if(h=e.match(c.reg),null!==h){r=h[0];break}}}if(null===r){f&&(f.pointer+=f.value.length);var v=d(s,p,p.length-1,"Tokenizer error","No matching token found");throw f&&(v+="\nBefore token of type "+f.type+": "+f.value),new Error(v)}f={type:o,value:r,pointer:l},p.push(f),l+=r.length,e=e.substr(r.length)}return p.push({type:"EOF",value:""}),p}function t(e,n){var r={type:e.type,value:e.value,repeat:n.repeat};return n.name&&(r.name=n.name),r}function o(e){var n={},r=0;return e.map(function(e){e.name&&("*"==e.repeat||"+"==e.repeat?(n[e.name]||(n[e.name]=[]),n[e.name].push(e)):n[e.name]=e),n["$"+r]=e,r++}),n}function i(e,n,r,t,i){for(var a,p,u=!1,f=e[n.key].hooks[n.index];;){if(a=t,p=s(e,n,r,a),p===!1||p.sp<=i.sp)return u;f&&!p.hooked&&(p.children=f(o(p.children)),p.hooked=!0),p.hooked=!0,i.children=p.children,i.sp=p.sp,i.start=p.start,i.hooked=p.hooked,u=p}return u}function a(e,n,r,t){for(var o=n.key+";"+t+";"+n.index,i=g.length-1;i>=0;){if(g[i][0]==o)return!1;i-=1}var a=m[n.key+";"+t];if(void 0!==a)return a;g.push([o,n]);var p=s(e,n,r,t);return g.pop(),p}function p(e,n){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&n.children.length&&n.children[n.children.length-1].type==e.type?!0:!1}function u(e){return"*"===e.repeat||"+"===e.repeat}function s(e,n,r,s){for(var f,l,h=s,c=0,d={type:n.key,children:[],start:s,name:n.name},v=n.tokens[c],y=r[h];v&&y;){if(e[v.type]){var k=e[v.type].rules,g=e[v.type].hooks;l=!1;var x=m[v.type+";"+h];if(x&&(l=x),!l)for(f=0;f<k.length;f++){var E=k[f],T=g&&g[f];if(l=a(e,E,r,h)){if(T&&!l.hooked&&(l.children=T(o(l.children))),l.hooked=!0,m[E.key+";"+h]=l,v.repeat===!1){var O=i(e,n,r,h,l);if(O!==!1)return O}break}}if(l)h=l.sp,d.children.push({type:v.type,children:l.children,sp:l.sp,name:v.name,repeat:v.repeat}),u(v)||c++;else{if(!p(v,d))return!1;c++}}else if(y.type===v.type)v.nonCapturing||(d.children.push(t(y,v)),h++),u(v)||c++;else{if(!p(v,d))return!1;c++}if(w===h&&b.candidates.push([n,n.tokens[c]]),h>w&&(b={sp:h,candidates:[[n,n.tokens[c]]]},w=h),v=n.tokens[c],y=r[h],void 0===v)return d.sp=h,d.rp=c,d;if(void 0===y)return p(v,d)?(d.sp=h,d.rp=c,d):!1}return!1}function f(e,n){return e.split(n).map(function(e){return e.trim()})}function l(e){var n="!"===e.charAt(0);n&&(e=e.substr(1));var r=e.charAt(e.length-1);"*"===r||"?"===r||"+"===r?e=e.substr(0,e.length-1):r=!1;var t,o=e.split(":");if(t=2===o.length?{type:o[1],name:o[0]}:{type:e},t.repeat=r,("*"===r||"+"===r)&&n)throw new Error("Impossible to have non capturing token that repeats");return n&&(t.nonCapturing=n),t}function h(e,n){var r,t,o,i=Object.keys(e),a={};a.tokenDef=n,a.tokenKeys=[],a.tokenMap={},n.map(function(e){a.tokenMap[e.key]=e,a.tokenKeys.push(e.key)});var p=i.concat(a.tokenKeys);for(r=0;r<i.length;r++){var u=e[i[r]],s=i[r],h=u.rules,c=[];for(t=0;t<h.length;t++){var d=f(h[t]," ");if(o=0,d=d.map(function(e){var n=l(e);if(-1===p.indexOf(n.type)&&"EOF"!==n.type)throw new Error("Invalid token type used in the grammar: "+n.type);if("*"===n.repeat&&(o+=1),n.nonCapturing&&d[d.length-1]!=e)throw new Error("Non capturing token has to be the last one in the rule: "+n.type);return n}),o===d.length)throw new Error("Rule "+h[t]+" only has * tokens.");c.push({key:s,index:t,tokens:d})}a[s]={rules:c,hooks:u.hooks||[],verbose:u.verbose}}return a.parse=function(e){return k(e,a)},a}function c(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function d(e,n,r,t,o){var i,a=n[r],p=a.pointer||0,u=e.split("\n"),s=0,f=0;for(i=0;i<u.length&&(s+=u[i].length+1,!(s>=p));i++)f+=u[i].length+1;var l=Math.max(0,i),h=t+" at line "+(l+1)+" char "+(p-f)+": ",d="\n"+c(p-f+(l+": ").length);return void 0!==u[l-1]&&(h=h+"\n"+l+": "+u[l-1]),h=h+"\n"+(l+1)+": "+u[l]+d,h=h+"^-- "+o,void 0!==u[l+1]&&(h=h+"\n"+(l+2)+": "+u[l+1]),h}function v(e,n){var r=e.tokenMap[n];return r&&r.verbose?r.verbose:e[n]&&e[n].verbose?e[n].verbose:n}function y(e,n,r,t){if(!r||!r.candidates[0])return"Complete failure to parse";var o=r.candidates[0][0],i=[];r.candidates.map(function(e){if(e[1]){var n=v(t,e[1].type);-1===i.indexOf(n)&&i.push(n)}});var a=i.join(" or "),p=d(e,n,r.sp,"Parser error","Rule "+v(t,o.key));p=p+"\nExpect "+a;var u=n[r.sp]||{type:"EOF"};return p=p+"\nBut got "+v(t,u.type)+" instead"}function k(e,n){var t,o,i,p={type:"START",sp:0,complete:!1};for(i=r(e,n),b={sp:0,candidates:[]},w=0,t=0;t<n.START.rules.length;t++)g=[],m={},o=a(n,n.START.rules[t],i,0),o&&o.sp>p.sp&&(p={type:"START",children:o.children,sp:o.sp,complete:o.sp===i.length,inputLength:i.length});return p.bestParse=b,b&&!p.complete&&(p.hint=y(e,i,b,n)),p}var g=[],m={},b=null,w=0;n.exports={parse:k,stack:g,compileGrammar:h,tokenize:r,memoization:m}},{}]},{},[1])(1)});