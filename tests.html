<html>
<head>
</head>
<body>
<script src='parser.js'></script>
<script>
window.onload = function(){

var tokens = {
  number: /^-?[0-9]+\.?[0-9]*/,
  term: /^[\+|-]/,
  fact: /^[\*|/]/,
  w: /^[ ]/,
  name: /^[a-zA-Z]+/,
  dot: /^\./,
  openP: /^\(/,
  closeP: /^\)/,
  comma: /^\,/,
  openB: /^\[/,
  closeB: /^\]/
};

var grammar = {
  "TERM": {rules:["TERM w term w FACT", "FACT"]},
  "FACT": {rules:["FACT w fact w number", "number"]},
  "PATH": {rules:["PATH dot name", "name"]},
  "EXPR": {rules:["openP EXPR closeP", "PATH openB EXPR closeB", "name comma EXPR", "PATH", "TERM"]},
  "START": {rules: ["EXPR"]}
};

var gram = EPEG.compileGrammar(grammar, tokens);

function parse(input) {
  var stream = EPEG.tokenize(input, tokens);
  return EPEG.parse(stream, gram);
}

function assertComplete(input) {
  var r = parse(input);
  if(!r.complete) {
    console.log("Incomplete parsing on: " + input + ", leftover " + input.slice(r.consumed), r);
  } else {
    console.log('pass');
  }
}

function assertIncomplete(input) {
  var r = parse(input);
  if(r.complete) {
    console.log("Complete: "+input, r);
  } else {
    console.log('pass');
  }
}

// test left recursion
assertComplete("1");
assertComplete("1 + 1");
assertComplete("1 + 1 - 1");
assertComplete("1 + 1 * 1 - 1 / 1 + 1");
assertIncomplete("1 + ");
assertIncomplete("+ 1");

// test right recursion
assertComplete("a,b,c,1");

// middle recursion
assertComplete("(0)");

assertComplete("abc.def[0][0]");

assertIncomplete("[0][0]");


var grammar = {
  "EXPR": {rules:["number dot* name", "w number w number?"]},
  "START": {rules: ["EXPR"]}
};

var gram = EPEG.compileGrammar(grammar, tokens);

assertComplete("6.....hello");
assertComplete("6hello");
assertIncomplete("6.....6");

assertComplete(" 6 6");
assertComplete(" 6 ");
assertIncomplete(" 6 6 6");


};
</script>
</body>